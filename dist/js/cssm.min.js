/*! @bivarcs/cssm 0.0.1 | MIT | https://github.com/bivarcs/cssm */
var e,t;e=this,t=function(){"use strict";var r=Object.defineProperty,s=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,f=(e,t,i)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;return class{constructor(){this.cache=[],this.style=[]}update(){for(let e=this.style,t=0;e.length>t;t++){var i=e[t];for(let e=i.use,t=0;e.length>t;t++){var r=e[t];this.isDead(r)&&i.use.splice(t--,1)}i.use.length||(i.element.remove(),this.style.splice(t--,1))}}attach(e,t,i){var r,s,o=this.findCache(e);o&&((r=this.findStyle(e))||((s=document.createElement("style")).innerHTML=o.text,this.style.push(r={id:e,element:s,use:[]})),o=r.element,r.use.some(e=>e.source===t)||this.isDead(e={source:t,life:i})||r.use.push(e),document.head.contains(o)||document.head.appendChild(o))}detach(e,i){if(this.findCache(e)){var r=this.findStyle(e);if(r)for(let e=r.use,t=0;e.length>t;t++)e[t].source===i&&r.use.splice(t--,1)}}isDead(e){var{source:e,life:t}=e;return"string"==typeof t?!e[t]:"function"==typeof t&&!t(e)}findStyle(e){return this.find("style",e)}findCache(e){return this.find("cache",e)}find(i,r){for(let e=this[i],t=0;e.length>t;t++){var s=e[t];if(s.id===r)return s}}create(t,e){this.cache.some(e=>e.id===t)||this.cache.push({id:t,text:e})}load(i,e){return this.findCache(i)?Promise.resolve(i):new Promise(t=>{fetch(i,((e,t)=>{for(var i in t=t||{})o.call(t,i)&&f(e,i,t[i]);if(s)for(var i of s(t))n.call(t,i)&&f(e,i,t[i]);return e})({method:"GET"},e||{})).then(e=>e.text()).then(e=>{this.create(i,e),t(i)}).catch(e=>{console.error(e),t(!1)})})}destroy(){this.style.forEach(e=>{e.element.remove()}),this.cache.length=0,this.style.length=0,this.status=!1}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).CSSM=t();
